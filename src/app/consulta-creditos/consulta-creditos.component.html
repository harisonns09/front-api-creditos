<div class="container">
  <h1 class="title">Consulta de Cr√©ditos</h1>


  <div class="top-actions">
    <button (click)="voltar()" class="btn-voltar">‚Üê Voltar</button>
    <button (click)="listarTodos()" class="btn-listar">Listar todos os cr√©ditos</button>
    <button class="btn-toggle-filtro" (click)="mostrarFiltro = !mostrarFiltro">
      üîç Filtrar por Valor Faturado
      <span [innerText]="mostrarFiltro ? '‚ñ≤' : '‚ñº'"></span>
    </button>
  </div>

    <div class="filtro-dropdown" *ngIf="mostrarFiltro">
      <form [formGroup]="filtroForm" (ngSubmit)="filtrarPorValorFaturado()" class="filtro-form">
        <div class="campo">
          <label for="valorMin">Valor M√≠nimo</label>
          <div class="input-wrapper">
            <span class="icone">R$</span>
            <input type="number" id="valorMin" formControlName="valorMin" placeholder="0.00" step="0.01" />
          </div>
        </div>

        <div class="campo">
          <label for="valorMax">Valor M√°ximo</label>
          <div class="input-wrapper">
            <span class="icone">R$</span>
            <input type="number" id="valorMax" formControlName="valorMax" placeholder="0.00" step="0.01" />
          </div>
        </div>

        <div class="acoes">
          <button type="submit" class="btn-filtrar" [disabled]="filtroForm.invalid">Aplicar Filtro</button>
          <button type="button" class="btn-limpar" (click)="limparFiltro()">Limpar</button>
        </div>
      </form>
    </div>
  


  <form [formGroup]="form" (ngSubmit)="buscar()" class="form">
    <input type="text" formControlName="numeroNfse" placeholder="N√∫mero da NFS-e" class="input" />
    <input type="text" formControlName="numeroCredito" placeholder="N√∫mero do Cr√©dito" class="input" />

    <div *ngIf="form.errors?.['apenasUmObrigatorio'] && (form.dirty || form.touched)" class="form-error">
      Por favor, preencha <strong>somente um</strong> dos campos.
    </div>

    <button type="submit" [disabled]="form.invalid || carregando" class="btn">
      {{ carregando ? 'Buscando...' : 'Buscar' }}
    </button>
  </form>




  <div *ngIf="!carregando && creditos.length === 0 && resultadoVazio" class="resultado-vazio">
    Nenhum resultado encontrado.
  </div>

  <div *ngIf="creditos.length > 0" class="tabela-container">
    <table class="tabela">
      <thead>
        <tr>
          <th></th> <!-- coluna para o radio -->
          <th>N√∫mero Cr√©dito</th>
          <th>N√∫mero NFS-e</th>
          <th>Data Constitui√ß√£o</th>
          <!-- <th>Valor ISSQN</th> -->
          <!-- <th>Tipo Cr√©dito</th> -->
          <!-- <th>Simples Nacional</th> -->
          <!-- <th>Al√≠quota</th> -->
          <th>Valor Faturado</th>
          <!-- <th>Valor Dedu√ß√£o</th> -->
          <!-- <th>Base de C√°lculo</th> -->
          <th>A√ß√µes</th> <!-- nova coluna -->
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of creditos" [class.selecionado]="creditoSelecionado?.numeroCredito === c.numeroCredito">
          <td>
            <input type="radio" name="creditoSelecionado" [value]="c" (change)="selecionarCredito(c)" />
          </td>
          <td>{{ c.numeroCredito }}</td>
          <td>{{ c.numeroNfse }}</td>
          <td>{{ c.dataConstituicao }}</td>
          <!-- <td>R$ {{ c.valorIssqn | number:'1.2-2' }}</td> -->
          <!-- <td>{{ c.tipoCredito }}</td> -->
          <!-- <td>{{ c.simplesNacional === true || c.simplesNacional === 'true' ? 'Sim' : 'N√£o' }}</td> -->
          <!-- <td>{{ c.aliquota | number:'1.2-2' }}%</td> -->
          <td>R$ {{ c.valorFaturado | number:'1.2-2' }}</td>
          <!-- <td>R$ {{ c.valorDeducao | number:'1.2-2' }}</td> -->
          <!-- <td>R$ {{ c.baseCalculo | number:'1.2-2' }}</td> -->
          <td>
            <button (click)="visualizarCredito(c.numeroCredito)" class="btn-visualizar">
              Abrir
            </button>
            <button (click)="excluirCredito(c.numeroCredito)" class="btn-excluir">
              Excluir
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>